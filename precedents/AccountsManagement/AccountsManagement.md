# Прецедент: "Управление учетной записью и данными"

**Информационная система жилищного агентства.**

**Уровень**: Задача, определенная пользователем.

**Основной исполнитель**: Пользователь (владелец или квартиросъемщик).

---

## Заинтересованные лица и их требования

- **Пользователь (владелец или квартиросъемщик)**:
  - Возможность редактировать личные данные (e-mail, телефон, пароль).
  - Управлять платежными реквизитами.
  - Удалить учетную запись, если потребуется, с предупреждением о последствиях.
  - Получать уведомления о ключевых изменениях в личных данных.

- **Администратор системы**:
  - Следить за корректностью обработки данных.
  - Обеспечивать безопасность данных в соответствии с требованиями законодательства.

- **Компания (владелец платформы)**:
  - Защита от утечек данных.
  - Возможность аудита всех действий с учетными записями.
  - Поддержание простоты и доступности интерфейса управления учетной записью.

---

## Предусловия

- Пользователь успешно прошел аутентификацию.
- У пользователя есть доступ к функционалу управления учетной записью в личном кабинете.

---

## Результаты (Постусловия)

1. Измененные данные пользователя сохранены в системе через методы `UserManager`.
2. При удалении учетной записи:
   - Данные удалены или помечены как неактивные в базе через метод `UserManager::deleteUser(userID)`.
   - Оповещения отправлены через `NotificationModule`.
3. Обновления платежных реквизитов обработаны через класс `Payment`.
4. Уведомления отправлены пользователю через `NotificationModule::sendNotification`.

---

## Основной успешный сценарий

1. **Доступ к настройкам учетной записи**:
    - Пользователь выбирает раздел "Настройки учетной записи".
    - Система загружает данные пользователя, используя метод `UserManager::getUserByID()`.

2. **Изменение личных данных**:
    - Пользователь редактирует данные, такие как имя, фамилия, e-mail или телефон.
    - Система проверяет данные через `BookingSystemFacade::validateUserData()`.
    - После проверки система вызывает метод `UserManager::addUser()` для сохранения изменений.

3. **Управление платежными данными**:
    - Пользователь переходит в раздел "Платежные данные".
    - Система предоставляет текущую информацию, используя `Payment::getDetails()`.
    - Пользователь изменяет или добавляет данные. Система вызывает `Payment::updateDetails()`.

4. **Удаление учетной записи**:
    - Пользователь выбирает опцию "Удалить учетную запись".
    - Система подтверждает действие, выводя предупреждение.
    - После подтверждения вызывается `UserManager::deleteUser(userID)`, а данные пользователя помечаются как удаленные.

5. **Уведомление о выполненных действиях**:
    - После каждого изменения или удаления данных система использует `NotificationModule::notifyObservers()` для отправки уведомлений.

---

## Варианты альтернативных решений

1. **Некорректные данные**:
    - Если данные не прошли проверку, `validateUserData()` возвращает ошибку.
    - Система уведомляет пользователя о необходимости исправить данные.

2. **Отмена удаления учетной записи**:
    - Если пользователь отказывается от удаления, процесс отменяется до выполнения метода `UserManager::deleteUser()`.

3. **Ошибки при сохранении изменений**:
    - Если данные не удалось сохранить, система использует `NotificationModule` для оповещения пользователя об ошибке.

4. **Действия администратора**:
    - Администратор может восстановить учетную запись через `UserManager::addUser()` (если предусмотрено).

---

## Расширения

1. **Обработка неактивных учетных записей**:
    - Система регулярно проверяет активность учетных записей.
    - Если учетная запись не используется более 6 месяцев, система уведомляет пользователя через `NotificationModule`.

2. **Многофакторная аутентификация**:
    - При изменении данных или удалении учетной записи пользователь подтверждает действия через дополнительный фактор (e-mail или SMS).

3. **Логирование действий**:
    - Все изменения логируются и хранятся для аудита через методы `Admin::logAction()`.

---

## Специальные требования

1. Все изменения обрабатываются с минимальными задержками (до 2 минут).
2. Уведомления отправляются на e-mail пользователя и в личный кабинет.
3. Система поддерживает защиту данных в соответствии с GDPR и внутренними стандартами.

---

## Открытые вопросы

1. Необходимо ли добавлять этап модерации перед окончательным удалением учетной записи?
2. Стоит ли реализовать "заморозку" учетной записи вместо полного удаления?
3. Какие дополнительные меры можно внедрить для защиты платежной информации?
