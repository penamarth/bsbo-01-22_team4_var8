
# Прецедент: "Управление учетной записью и данными"

**Информационная система жилищного агентства.**

**Уровень**: Задача, определенная пользователем.

**Основной исполнитель**: Пользователь (арендатор, владелец или администратор).

---

## Заинтересованные лица и их требования

- **Пользователь (арендатор или владелец)**:
  - Возможность редактировать личные данные (имя, фамилия, e-mail, телефон, пароль).
  - Управлять связанными объектами (недвижимость или избранное).
  - Удалить учетную запись с предупреждением о последствиях.
  - Получать уведомления о ключевых изменениях учетной записи.

- **Администратор**:
  - Контролировать корректность и безопасность данных пользователей.
  - Восстанавливать удаленные учетные записи при необходимости.
  - Логировать все действия для обеспечения возможности аудита.

- **Компания (владелец платформы)**:
  - Гарантировать безопасность данных пользователей.
  - Обеспечивать простоту и доступность интерфейса управления учетной записью.

---

## Предусловия

- Пользователь успешно прошел аутентификацию.
- У пользователя есть доступ к разделу "Настройки учетной записи".

---

## Результаты (Постусловия)

1. Измененные данные пользователя сохранены через методы `UserManager`.
2. Учетная запись пользователя удалена или помечена как неактивная через `UserManager::deleteUser(userID)`.
3. Уведомления об изменениях отправлены через `Property::notifyObservers()` или напрямую через `Notification`.
4. Связанные объекты обновлены или переназначены через `PropertyManager` и `BookingManager`.

---

## Основной успешный сценарий

1. **Доступ к настройкам учетной записи**:
    - Пользователь выбирает раздел "Настройки учетной записи".
    - Система загружает данные пользователя с помощью метода `UserManager::getUserByID(userID)`.

2. **Редактирование личных данных**:
    - Пользователь вводит новые данные (e-mail, телефон и т. д.).
    - Система проверяет данные через `BookingSystemFacade::validateUserData(data)`.
    - После успешной проверки данные сохраняются через `UserManager::updateUser(userID, updatedUser)`.

3. **Обновление данных о недвижимости** (для владельца):
    - Пользователь изменяет данные объекта недвижимости.
    - Система вызывает метод `PropertyManager::updateProperty(propertyID, updatedProperty)`.

4. **Управление избранным** (для арендатора):
    - Пользователь добавляет или удаляет объект из избранного.
    - Система обновляет данные через `Tenant::FavoriteListings`.

5. **Удаление учетной записи**:
    - Пользователь выбирает "Удалить учетную запись".
    - Система предупреждает пользователя о последствиях.
    - При подтверждении вызывается `UserManager::deleteUser(userID)`, а связанные данные помечаются как неактивные.

6. **Уведомления о выполненных действиях**:
    - Система отправляет уведомления о всех изменениях через `Property::notifyObservers(notification)`.

---

## Варианты альтернативных решений

1. **Некорректные данные**:
    - Если данные не прошли проверку, `validateUserData()` возвращает ошибку.
    - Пользователь уведомляется о необходимости исправления данных.

2. **Отмена удаления учетной записи**:
    - Пользователь отказывается от удаления до вызова метода `UserManager::deleteUser()`.

3. **Ошибки при обновлении данных**:
    - При сбое обновления система уведомляет пользователя через `Notification`.

4. **Вмешательство администратора**:
    - Администратор может восстановить удаленную учетную запись с помощью `UserManager::addUser()`.

---

## Расширения

1. **Многофакторная аутентификация**:
    - Подтверждение действий (например, удаления) через SMS или e-mail.

2. **Автоматическое уведомление владельцев объектов**:
    - При удалении учетной записи владельца система уведомляет арендаторов о возможных изменениях.

3. **Логирование изменений**:
    - Логируются все действия через методы `Administrator::logAction()`.

---

## Специальные требования

1. Все действия выполняются в пределах 1-2 минут.
2. Уведомления отправляются в личный кабинет и на e-mail.
3. Система обеспечивает соответствие GDPR.

---

## Открытые вопросы

1. Какой формат уведомлений предпочтителен для пользователей (e-mail, push-уведомления)?
2. Нужно ли блокировать учетную запись перед окончательным удалением?
3. Какие дополнительные меры следует внедрить для повышения безопасности?
